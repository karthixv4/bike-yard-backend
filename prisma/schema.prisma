generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id              String           @id @default(uuid())
  email           String           @unique
  password        String
  name            String
  phone           String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  profileImageId  String?          @unique
  addresses       Address[]
  adminProfile    AdminProfile?
  bookings        Booking[]
  cart            CartItem[]
  inspections     Inspection[]     @relation("BuyerInspections")
  mechanicProfile MechanicProfile?
  orders          Order[]
  reviews         Review[]
  sellerProfile   SellerProfile?
  profileImage    Image?           @relation("UserProfileImage", fields: [profileImageId], references: [id])
}

model Image {
  id        String   @id @default(uuid())
  publicId  String   @unique
  url       String
  width     Int?
  height    Int?
  format    String?
  size      Int?
  position  Int?
  productId String?
  createdAt DateTime @default(now())
  product   Product? @relation(fields: [productId], references: [id], onDelete: Cascade)
  profileOf User?    @relation("UserProfileImage")

  @@index([productId])
}

model Address {
  id      String @id @default(uuid())
  userId  String
  street  String
  city    String
  state   String
  zip     String
  country String @default("India")
  user    User   @relation(fields: [userId], references: [id])
}

model SellerProfile {
  id           String    @id @default(uuid())
  userId       String    @unique
  businessName String?
  gstNumber    String?
  isVerified   Boolean   @default(false)
  listings     Product[]
  user         User      @relation(fields: [userId], references: [id])
}

model MechanicProfile {
  id              String       @id @default(uuid())
  userId          String       @unique
  experienceYears Int
  shopAddress     String
  isMobileService Boolean      @default(false)
  hourlyRate      Float?
  isVerified      Boolean      @default(false)
  bookings        Booking[]
  inspections     Inspection[]
  user            User         @relation(fields: [userId], references: [id])
  services        Service[]
}

model AdminProfile {
  id     String @id @default(uuid())
  userId String @unique
  level  Int    @default(1)
  user   User   @relation(fields: [userId], references: [id])
}

model Category {
  id       String    @id @default(uuid())
  name     String    @unique
  products Product[]
}

model Product {
  id          String        @id @default(uuid())
  sellerId    String
  type        ProductType
  title       String
  description String
  price       Float
  condition   Condition?
  brand       String?
  model       String?
  year        Int?
  kmDriven    Int?
  ownership   Int?
  stock       Int           @default(1)
  isSold      Boolean       @default(false)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  categoryId  String
  cartItems   CartItem[]
  images      Image[]
  inspections Inspection[]
  orderItems  OrderItem[]
  category    Category      @relation(fields: [categoryId], references: [id])
  seller      SellerProfile @relation(fields: [sellerId], references: [id])
  reviews     Review[]
  address     String?
}

model Service {
  id          String          @id @default(uuid())
  mechanicId  String
  name        String
  description String?
  basePrice   Float
  bookings    Booking[]
  mechanic    MechanicProfile @relation(fields: [mechanicId], references: [id])
}

model Booking {
  id         String          @id @default(uuid())
  customerId String
  mechanicId String
  serviceId  String
  date       DateTime
  status     BookingStatus   @default(PENDING)
  notes      String?
  createdAt  DateTime        @default(now())
  customer   User            @relation(fields: [customerId], references: [id])
  mechanic   MechanicProfile @relation(fields: [mechanicId], references: [id])
  service    Service         @relation(fields: [serviceId], references: [id])
}

model CartItem {
  id        String  @id @default(uuid())
  userId    String
  productId String
  quantity  Int     @default(1)
  product   Product @relation(fields: [productId], references: [id])
  user      User    @relation(fields: [userId], references: [id])
}

model Order {
  id          String      @id @default(uuid())
  buyerId     String
  totalAmount Float
  status      OrderStatus @default(PENDING)
  paymentId   String?
  createdAt   DateTime    @default(now())
  buyer       User        @relation(fields: [buyerId], references: [id])
  items       OrderItem[]
}

model OrderItem {
  id              String  @id @default(uuid())
  orderId         String
  productId       String
  quantity        Int
  priceAtPurchase Float
  order           Order   @relation(fields: [orderId], references: [id])
  product         Product @relation(fields: [productId], references: [id])
}

model Review {
  id        String   @id @default(uuid())
  authorId  String
  productId String?
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  author    User     @relation(fields: [authorId], references: [id])
  product   Product? @relation(fields: [productId], references: [id])
}

model Inspection {
  id              String           @id @default(uuid())
  productId       String
  buyerId         String
  mechanicId      String?
  offerAmount     Float
  message         String?
  status          InspectionStatus @default(PENDING)
  rejectionReason String?
  reportData      Json?
  scheduledDate   DateTime?
  completedAt     DateTime?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  buyer           User             @relation("BuyerInspections", fields: [buyerId], references: [id])
  mechanic        MechanicProfile? @relation(fields: [mechanicId], references: [id])
  product         Product          @relation(fields: [productId], references: [id])
}

enum ProductType {
  BIKE
  ACCESSORY
  PART
}

enum Condition {
  NEW
  USED
  REFURBISHED
  OPEN_BOX
  NEEDS_WORK
  MINT
  GOOD
}

enum OrderStatus {
  PENDING
  PAID
  SHIPPED
  DELIVERED
  CANCELLED
}

enum BookingStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}

enum InspectionStatus {
  PENDING
  ACCEPTED
  REJECTED
  COMPLETED
  CANCELLED
}
